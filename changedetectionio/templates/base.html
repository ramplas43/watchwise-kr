<!DOCTYPE html>
<html lang="ko" data-darkmode="{{ get_darkmode_state() }}">

  <head>
    <meta charset="utf-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1.0" >
    <meta name="description" content="웹페이지 변경을 감지하고 자동으로 알림을 받는 서비스, WatchWise." >
    <meta name="robots" content="noindex">
    <title>WatchWise - 웹페이지 변경 알림 서비스</title>

    {% if app_rss_token %}
      <link rel="alternate" type="application/rss+xml" title="WatchWise » Feed{% if active_tag_uuid %}- {{active_tag.title}}{% endif %}" href="{{ url_for('rss.feed', tag=active_tag_uuid , token=app_rss_token)}}" >
    {% endif %}

    <link rel="stylesheet" href="{{url_for('static_content', group='styles', filename='pure-min.css')}}" >
    <link rel="stylesheet" href="{{url_for('static_content', group='styles', filename='styles.css')}}?v={{ get_css_version() }}" >
    {% if extra_stylesheets %}
      {% for m in extra_stylesheets %}
        <link rel="stylesheet" href="{{ m }}?ver={{ get_css_version() }}" >
      {% endfor %}
    {% endif %}

    <link rel="apple-touch-icon" sizes="180x180" href="{{url_for('static_content', group='favicons', filename='apple-touch-icon.png')}}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{url_for('static_content', group='favicons', filename='favicon-32x32.png')}}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{url_for('static_content', group='favicons', filename='favicon-16x16.png')}}">
    <link rel="manifest" href="{{url_for('static_content', group='favicons', filename='site.webmanifest')}}">
    <meta name="theme-color" content="#2b2d42">

    <script>
      const csrftoken = "{{ csrf_token() }}";
      const socketio_url = "{{ get_socketio_path() }}/socket.io";
      const is_authenticated = {% if current_user.is_authenticated or not has_password %}true{% else %}false{% endif %};
    </script>

    <script src="{{url_for('static_content', group='js', filename='jquery-3.6.0.min.js')}}"></script>
    <script src="{{url_for('static_content', group='js', filename='csrf.js')}}" defer></script>
    <script src="{{url_for('static_content', group='js', filename='feather-icons.min.js')}}" defer></script>
    {% if socket_io_enabled %}
      <script src="{{url_for('static_content', group='js', filename='socket.io.min.js')}}"></script>
      <script src="{{url_for('static_content', group='js', filename='realtime.js')}}" defer></script>
    {% endif %}
  </head>

  <body class="{{extra_classes}}">
    <div class="header">
      <div class="pure-menu-fixed" style="width: 100%;">
        <div class="home-menu pure-menu pure-menu-horizontal" id="nav-menu">

          {% if has_password and not current_user.is_authenticated %}
            <a class="pure-menu-heading" href="#" rel="noopener">
              <strong>Watch</strong>Wise
            </a>
          {% else %}
            <a class="pure-menu-heading" href="{{url_for('watchlist.index')}}">
              <strong>Watch</strong>Wise
            </a>
          {% endif %}

          <ul class="pure-menu-list" id="top-right-menu">
            {% if current_user.is_authenticated or not has_password %}
              {% if not current_diff_url %}
                <li class="pure-menu-item"><a href="{{ url_for('tags.tags_overview_page')}}" class="pure-menu-link">그룹</a></li>
                <li class="pure-menu-item"><a href="{{ url_for('settings.settings_page')}}" class="pure-menu-link">설정</a></li>
                <li class="pure-menu-item"><a href="{{ url_for('imports.import_page')}}" class="pure-menu-link">가져오기</a></li>
                <li class="pure-menu-item"><a href="{{ url_for('backups.index')}}" class="pure-menu-link">백업</a></li>
              {% else %}
                <li class="pure-menu-item"><a href="{{ url_for('ui.ui_edit.edit_page', uuid=uuid, next='diff') }}" class="pure-menu-link">편집</a></li>
              {% endif %}
            {% endif %}

            {% if current_user.is_authenticated %}
              <li class="pure-menu-item"><a href="{{url_for('logout')}}" class="pure-menu-link">로그아웃</a></li>
            {% endif %}

            {% if current_user.is_authenticated or not has_password %}
              <li class="pure-menu-item pure-form" id="search-menu-item">
                <form name="searchForm" action="" method="GET">
                  <input id="search-q" name="q" placeholder="URL 또는 제목 검색" required type="text" value="">
                  <button class="toggle-button" id="toggle-search" type="button" title="검색 (Alt+S)">
                    {% include "svgs/search-icon.svg" %}
                  </button>
                </form>
              </li>
            {% endif %}

            <li class="pure-menu-item">
              <button class="toggle-button" id="toggle-light-mode" type="button" title="라이트/다크 모드 전환">
                <span class="visually-hidden">Toggle light/dark mode</span>
                <span class="icon-light">{% include "svgs/light-mode-toggle-icon.svg" %}</span>
                <span class="icon-dark">{% include "svgs/dark-mode-toggle-icon.svg" %}</span>
              </button>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <section class="content">
      <header>{% block header %}{% endblock %}</header>

      {% with messages = get_flashed_messages(with_categories = true) %}
        {% if messages %}
          <ul class="messages">
            {% for category, message in messages %}
              <li class="{{ category }}">{{ message }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      {% endwith %}

      {% block content %}{% endblock %}
    </section>

    <footer style="text-align:center; margin-top:2em; font-size:0.9em; color:#666;">
      <p>© 2025 WatchWise — Powered by <a href="https://github.com/dgtlmoon/changedetection.io" target="_blank">changedetection.io</a></p>
    </footer>

    <script src="{{url_for('static_content', group='js', filename='toggle-theme.js')}}" defer></script>
  </body>
</html>